# ğŸ¤– GitHub Actions CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆã—ã¦ãƒ“ãƒ«ãƒ‰ã—ã¾ã™

name: CI Pipeline

# ğŸ“Œ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒˆãƒªã‚¬ãƒ¼
on:
  push:
    branches: [ main, develop ]  # main ã¾ãŸã¯ develop ã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã§å®Ÿè¡Œ
  pull_request:
    branches: [ main, develop ]  # main ã¾ãŸã¯ develop ã¸ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å®Ÿè¡Œ

# ğŸ“‹ å®Ÿè¡Œã™ã‚‹ä»•äº‹ï¼ˆã‚¸ãƒ§ãƒ–ï¼‰ã®å®šç¾©
jobs:
  build:
    # ğŸ–¥ï¸ å®Ÿè¡Œç’°å¢ƒ: Ubuntu æœ€æ–°ç‰ˆ
    runs-on: ubuntu-latest
    
    # ğŸ“¦ è¤‡æ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè¡Œï¼ˆãƒãƒˆãƒªãƒƒã‚¯ã‚¹ï¼‰
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    # ğŸ”§ å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—
    steps:
      # 1ï¸âƒ£ ã‚¹ãƒ†ãƒƒãƒ—1: GitHub ã«ã‚ã‚‹æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      # 2ï¸âƒ£ ã‚¹ãƒ†ãƒƒãƒ—2: Node.js ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: ğŸ”§ Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'  # ï¿½ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ã§é«˜é€ŸåŒ–
      
      # 3ï¸âƒ£ ã‚¹ãƒ†ãƒƒãƒ—3: npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: ğŸ“¦ Install dependencies
        run: npm install
      
      # 4ï¸âƒ£ ã‚¹ãƒ†ãƒƒãƒ—4: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆESLintï¼‰
      - name: ğŸ” Lint code
        run: npm run lint --if-present || true
        continue-on-error: true  # ã‚¨ãƒ©ãƒ¼ã§ã‚‚ç¶šè¡Œ
      
      # 5ï¸âƒ£ ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
      - name: ğŸ—ï¸ Build project
        run: npm run build
      
      # 6ï¸âƒ£ ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
      - name: âœ… Run tests
        run: npm test -- --watchAll=false --passWithNoTests 2>/dev/null || true
        continue-on-error: true  # ãƒ†ã‚¹ãƒˆå¤±æ•—ã§ã‚‚ç¶šè¡Œ

  # ğŸ‰ æˆåŠŸé€šçŸ¥
  notify:
    name: ğŸ“¢ Notify Success
    needs: build
    runs-on: ubuntu-latest
    if: success()
    steps:
      - name: âœ¨ Success Message
        run: echo "ğŸ‰ ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã«åˆæ ¼ã—ã¾ã—ãŸï¼"
